#!/bin/bash
if [ -z "$1" ] || [ -z "$2" ]; then
    echo "usage:"
    echo "user <username> <full name> [shell]"
    exit 5
fi

if ! [ "$UID" == "0" ]; then
    echo "this script must be run with super user privileges"
    exit 6
fi

# Set default shell or use provided shell
SHELL_PATH="/bin/bash"

if [ -n "$3" ]; then
    # Check if the provided shell exists in /etc/shells
    if grep -q "^$3$" /etc/shells; then
        SHELL_PATH="$3"
    else
        echo "Warning: Shell '$3' not found in /etc/shells. Using default /bin/bash"
    fi
fi

adduser --quiet --disabled-password --shell "$SHELL_PATH" --gecos "$2" "$1"
passwd --stdin "$1"
usermod -a -G sudo,adm,lpadmin "$1"
